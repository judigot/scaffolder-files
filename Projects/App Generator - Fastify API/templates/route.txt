import type { FastifyInstance, FastifyRequest, FastifyReply } from 'fastify';
import { {{tableNamePascalCaseSingular}}Service } from '../services/{{tableNameCamelCase}}.service.js';

const service = new {{tableNamePascalCaseSingular}}Service();

export const register{{tableNamePascalCaseSingular}}Routes = (app: FastifyInstance): void => {
  app.get('/api/{{tableNameKebabCasePlural}}', async (_request: FastifyRequest, reply: FastifyReply) => {
    const items = await service.getAll();
    return reply.send(items);
  });

  app.get('/api/{{tableNameKebabCasePlural}}/:id', async (request: FastifyRequest<{ Params: { id: string } }>, reply: FastifyReply) => {
    const item = await service.getById(Number(request.params.id));
    if (!item) return reply.status(404).send({ error: '{{tableNamePascalCaseSingular}} not found' });
    return reply.send(item);
  });

  app.post('/api/{{tableNameKebabCasePlural}}', async (request: FastifyRequest, reply: FastifyReply) => {
    const item = await service.create(request.body as Record<string, unknown>);
    return reply.status(201).send(item);
  });

  app.put('/api/{{tableNameKebabCasePlural}}/:id', async (request: FastifyRequest<{ Params: { id: string } }>, reply: FastifyReply) => {
    const item = await service.update(Number(request.params.id), request.body as Record<string, unknown>);
    if (!item) return reply.status(404).send({ error: '{{tableNamePascalCaseSingular}} not found' });
    return reply.send(item);
  });

  app.delete('/api/{{tableNameKebabCasePlural}}/:id', async (request: FastifyRequest<{ Params: { id: string } }>, reply: FastifyReply) => {
    const success = await service.delete(Number(request.params.id));
    if (!success) return reply.status(404).send({ error: '{{tableNamePascalCaseSingular}} not found' });
    return reply.status(204).send();
  });
};
