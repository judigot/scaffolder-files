import type { I{{tableNamePascalCaseSingular}}, ICreate{{tableNamePascalCaseSingular}} } from '../types/{{tableNameCamelCase}}.types.js';
import { {{tableNameCamelCasePlural}}, getNext{{tableNamePascalCaseSingular}}Id } from '../db/{{tableNameCamelCase}}.store.js';

export class {{tableNamePascalCaseSingular}}Service {
  async getAll(): Promise<I{{tableNamePascalCaseSingular}}[]> {
    return {{tableNameCamelCasePlural}};
  }

  async getById(id: number): Promise<I{{tableNamePascalCaseSingular}} | undefined> {
    return {{tableNameCamelCasePlural}}.find((item) => item.{{getPrimaryKey()}} === id);
  }

  async create(data: ICreate{{tableNamePascalCaseSingular}}): Promise<I{{tableNamePascalCaseSingular}}> {
    const newItem: I{{tableNamePascalCaseSingular}} = {
      {{getPrimaryKey()}}: getNext{{tableNamePascalCaseSingular}}Id(),
      ...data,
      created_at: new Date(),
      updated_at: new Date(),
    };
    {{tableNameCamelCasePlural}}.push(newItem);
    return newItem;
  }

  async update(id: number, data: Partial<ICreate{{tableNamePascalCaseSingular}}>): Promise<I{{tableNamePascalCaseSingular}} | undefined> {
    const index = {{tableNameCamelCasePlural}}.findIndex((item) => item.{{getPrimaryKey()}} === id);
    if (index === -1) return undefined;
    {{tableNameCamelCasePlural}}[index] = { ...{{tableNameCamelCasePlural}}[index], ...data, updated_at: new Date() };
    return {{tableNameCamelCasePlural}}[index];
  }

  async delete(id: number): Promise<boolean> {
    const index = {{tableNameCamelCasePlural}}.findIndex((item) => item.{{getPrimaryKey()}} === id);
    if (index === -1) return false;
    {{tableNameCamelCasePlural}}.splice(index, 1);
    return true;
  }
}
