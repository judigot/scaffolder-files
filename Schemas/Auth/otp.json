{
  "$schema": "../../schema-definition.json",
  "name": "auth-otp",
  "description": "One-Time Password codes for email/SMS verification",
  "version": "1.0.0",
  "requires": ["auth-base"],
  "tables": {
    "otpCode": {
      "description": "One-time verification codes",
      "columns": {
        "id": {
          "type": "uuid",
          "primary": true,
          "default": "gen_random_uuid()"
        },
        "userId": {
          "type": "uuid",
          "nullable": false,
          "references": {
            "table": "user",
            "column": "id",
            "onDelete": "CASCADE"
          }
        },
        "code": {
          "type": "varchar",
          "length": 10,
          "nullable": false,
          "description": "The OTP code (typically 6 digits)"
        },
        "type": {
          "type": "varchar",
          "length": 50,
          "nullable": false,
          "description": "Purpose: email_verification, password_reset, login, etc."
        },
        "expiresAt": {
          "type": "timestamp",
          "nullable": false
        },
        "usedAt": {
          "type": "timestamp",
          "nullable": true
        },
        "createdAt": {
          "type": "timestamp",
          "default": "now()",
          "nullable": false
        }
      },
      "indexes": [
        { "columns": ["userId"] },
        { "columns": ["code", "type"] },
        { "columns": ["expiresAt"] }
      ]
    }
  }
}
