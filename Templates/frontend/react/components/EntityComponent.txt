import { useEffect, useMemo, useState } from 'react';
import DataTable from '@components/DataTable.tsx';
import { use{{tableName.singular.pascalCase}} } from '@/hooks/{{tableName.singular.kebabCase}}/use{{tableName.singular.pascalCase}}.ts';
import { useCreate{{tableName.singular.pascalCase}} } from '@/hooks/{{tableName.singular.kebabCase}}/useCreate{{tableName.singular.pascalCase}}.ts';
import { useUpdate{{tableName.singular.pascalCase}} } from '@/hooks/{{tableName.singular.kebabCase}}/useUpdate{{tableName.singular.pascalCase}}.ts';
import { useDelete{{tableName.singular.pascalCase}} } from '@/hooks/{{tableName.singular.kebabCase}}/useDelete{{tableName.singular.pascalCase}}.ts';
import { type I{{tableName.singular.pascalCase}} } from '@/interfaces/I{{tableName.singular.pascalCase}}.ts';

export default function {{tableName.singular.pascalCase}}Component() {
  const { data = [], isLoading, refetch } = use{{tableName.singular.pascalCase}}();
  const { mutate: createRecord } = useCreate{{tableName.singular.pascalCase}}({ onSuccess: refetch });
  const { mutate: updateRecord } = useUpdate{{tableName.singular.pascalCase}}();
  const { mutate: deleteRecord } = useDelete{{tableName.singular.pascalCase}}({ onSuccess: refetch });

  const columns = useMemo(() => {
    if (data.length === 0) return [];
    return Object.keys(data[0]).filter(key => key !== 'id').map(key => ({
      accessorKey: key,
      header: key.charAt(0).toUpperCase() + key.slice(1),
      cell: (info: any) => info.getValue(),
    }));
  }, [data]);

  const handleSearch = (query: string) => {
    refetch(); // If search logic is backend-driven, update parameters in hook
  };

  return (
    <DataTable<I{{tableName.singular.pascalCase}}>
      data={data}
      columns={columns}
      searchPlaceholder={`Search {{tableName.plural.pascalCase}}...`}
      onSearch={handleSearch}
      isLoading={isLoading}
      onDelete={(id) => deleteRecord(id)}
      onUpdate={(id, values) => updateRecord(id, values)}
    />
  );
}
